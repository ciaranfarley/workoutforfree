{% extends "layout.html" %}
{% block content %}
<form method="POST" action="">
    {{ form.hidden_tag() }}
    <fieldset class="form-group">
        <div class="form-group">
            {{ form.search.label(class="form-control-label") }}
            {% if form.search.errors %}
                {{ form.search(class="form-control form-control-lg is-invalid") }}
                <div class="invalid-feedback">
                    {% for error in form.search.errors %}
                        <span>{{ error }}</span>
                    {% endfor %}
                </div>
            {% else %}
                {{ form.search(class="form-control form-control-lg", id='search_term') }}
            {% endif %}
        </div>
    </fieldset>
    <div class="form-group">
        {{ form.submit(class="btn btn-outline-info") }}
    </div>

    {% for gym in search.gyms %}
    	{% if gym.search_id == search.id %}
		   <article class="media content-section">
	        	<div class="media-body">
	        		{% for info in gym.info %}
		            	{% if info.search_id == search.id %}
		           		<h2><a class="article-title" href="{{ info.link}}" target="_blank">{{ gym.name }}</a></h2>
		            	<p class="article-content" > {{info.description}}</p>
		            	{% endif %}
		            {% endfor %}
		            {% for location in gym.locations %}
		            	{% if location.search_id == search.id %}
				            <a href="{{location.link}}" target="_blank"> 
				            	<p class="article-content"> {{ location.address}}</p>
				            </a>
			            {% endif%}
			        {% endfor%}
	          	</div>
	        </article>
	    {% endif %}
    {% endfor %}
<!--     <script type="text/javascript">
     function initAutocomplete(){
      var input = document.getElementById('search_term');
      var autocomplete = new google.maps.places.Autocomplete(input);
    }
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxq6oC2dG2L7oHlKG2jaBeYUMjye8fzDQ&libraries=places&callback=activatePlacesSearch"async defer>
	</script> -->
	
	</div><!-- this closes the column thatt contains results -->
	<div class="col-sm" id='map' style="height: 500px;">
	<script>
	const Http = new XMLHttpRequest();
	const url='127.0.0.1:5000/data';
	Http.open("GET", url);
	Http.send();
	Http.onreadystatechange=(e)=>{
	console.log(Http.responseText)
	}

      function initMap() {
        var myLatLng = {lat: 40.7, lng: -74};

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 10,
          center: myLatLng
        });

        var marker = new google.maps.Marker({
          position: myLatLng,
          map: map,
          title: 'Hello World!'
        });
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxq6oC2dG2L7oHlKG2jaBeYUMjye8fzDQ&callback=initMap">
    </script>

	</div>
 </div><!-- this closes the row that contains everything-->
{% endblock content %}
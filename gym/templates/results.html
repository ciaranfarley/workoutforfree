{% extends "layout.html" %}
{% block content %}

    <form class='form-group' action='{{url_for('main.home')}}'>
         <button class="btn btn-outline-info" >
        	Search again
        </button>   	
    </form>
    {% for gym in search.gyms %}
    	{% if gym.search_id == search.id %}
		   <article class="media content-section">
	        	<div class="media-body">
	        		{% for info in gym.info %}
		            	{% if info.search_id == search.id %}
		           		<h2><a class="article-title" href="{{ info.link}}" target="_blank">{{ gym.name }}</a></h2>
		            	<p class="article-content" > {{info.description}}</p>
		            	{% endif %}
		            {% endfor %}
		            {% for location in gym.locations %}
		            	{% if location.search_id == search.id %}
				            <a href="{{location.link}}" target="_blank"> 
				            	<p class="article-content"> {{ location.address}}</p>
				            </a>
			            {% endif%}
			        {% endfor%}
	          	</div>
	        </article>
	    {% endif %}
    {% endfor %}
    <script type="text/javascript">

	function initMap() {
		
    	const Http = new XMLHttpRequest();
		const url=SCRIPT_ROOT + '/coordinates';
		Http.open("GET", url);
		Http.send();
		Http.onreadystatechange=(e)=>{
			var data = JSON.parse(Http.responseText).data;

			//this loop just defines the lat,lng for the map 
			//edit api to pass search coordinates 	
			var gym;
			for (gym in data){
				var LatLng = {'lat': data[gym][0]['coordinates'][0], 'lng': data[gym][0]['coordinates'][1]};
			}

			var map = new google.maps.Map(document.getElementById('map'), {
				zoom: 11,
				center: LatLng
			});

			//this loop adds markers 
			for (gym in data){
				for(i=0; i < data[gym].length; i++){
					var LatLng = {'lat': data[gym][i]['coordinates'][0], 'lng': data[gym][i]['coordinates'][1]};

					var contentString = '<div><h2>'+ gym.toString() + '</h3> <p> This is a great gym! </p>'+
					'<p>'+ data[gym][i]['address'].toString() + '</p> <a href='+ data[gym][i]['link'].toString() +'> Open in maps </a></div>';
					var infowindow = new google.maps.InfoWindow({
			          content: contentString
			        });
					var marker = new google.maps.Marker({
						position: LatLng,
						map: map,
						title: 'Gym'
					});
					marker.addListener('click', function() {
			          infowindow.open(map, marker);
			        });
				
				}
			}	
		}

	}
    </script>
	
	</div><!-- this closes the column thatt contains results -->
	<div class="col-sm" id='map' style="height: 500px;">
    <script> SCRIPT_ROOT = {{ request.script_root|tojson|safe }}; </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxq6oC2dG2L7oHlKG2jaBeYUMjye8fzDQ&callback=initMap">
    </script>
    

	</div>
 </div><!-- this closes the row that contains everything-->
{% endblock content %}
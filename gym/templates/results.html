{% extends "layout.html" %}
{% block content %}

    <form class='form-group' action='{{url_for('main.home')}}'>
         <button class="btn btn-outline-info" >
        	Search for more passes
        </button>   	
    </form>
    {% for gym in search.gyms %}
    	{% if gym.search_id == search.id %}
		   <article class="media content-section">
	        	<div class="media-body">
	        		{% for info in gym.info %}
		            	{% if info.search_id == search.id %}
		           		<h2><a class="article-title" href="{{ info.link}}" target="_blank">{{ gym.name }}</a></h2>
		            	<p class="article-content" > {{info.description}}</p>
		            	{% endif %}
		            {% endfor %}
		            {% for location in gym.locations %}
		            	{% if location.search_id == search.id %}
				            <a href="{{location.link}}" target="_blank"> 
				            	<p class="article-content"> {{ location.address}}</p>
				            </a>
			            {% endif%}
			        {% endfor%}
	          	</div>
	        </article>
	    {% endif %}
    {% endfor %}
	
	</div><!-- this closes the column thatt contains results -->
	<div class="col-sm" id='map' style="height: 600px;">
	</div>
 </div><!-- this closes the row that contains everything-->
    <script type="text/javascript">

	function initMap() {
		
    	const Http = new XMLHttpRequest();
		const url=SCRIPT_ROOT + '/coordinates';
		Http.open("GET", url);
		Http.send();
		Http.onreadystatechange=(e)=>{
			var data = JSON.parse(Http.responseText).data;
			//get search coordinates 
			var center = {'lat': data.center[0], 'lng': data.center[1]};
			var map = new google.maps.Map(document.getElementById('map'), {
				zoom: 11,
				center: center
			});

			var yourLocation = new google.maps.Marker({
				position: center,
				map: map,
				title: 'Your Location',
				icon: 'https://maps.google.com/mapfiles/ms/icons/blue-dot.png'
			});

			//this loop adds markers 
			for(i=0; i < data.gyms.length; i++){
				var gym_info = data.gyms[i];
				var LatLng = {'lat': gym_info['coordinates'][0], 'lng': gym_info['coordinates'][1]};

				var contentString = '<div class="infowindow"><h6 style="margin-bottom:.2rem;">'+ gym_info['name'] + '</h6> <p style="margin-bottom:1%"> This is a great gym!</p>'+'<p style="margin-bottom:1%">'+ gym_info['address'] + '</p> <a href='+ gym_info['link'] +' target="_blank"> View on Google Maps </a></div>';
				var infowindow = new google.maps.InfoWindow({
		          content: contentString
		        });
				var marker = new google.maps.Marker({
					position: LatLng,
					map: map,
					title: gym_info['name'] + ' location'
				});
				marker.infowindow = infowindow;

				marker.addListener('click', function() {
					return this.infowindow.open(map, this);
				});
			
			}
				

		}

	}
    </script>

     <script> SCRIPT_ROOT = {{ request.script_root|tojson|safe }}; </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxq6oC2dG2L7oHlKG2jaBeYUMjye8fzDQ&callback=initMap">
    </script>
{% endblock content %}